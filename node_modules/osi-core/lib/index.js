var fs = require('fs');
// Define the home route
var homeConfig = require('../cfg/home.json');
var homeconfig = {
    handler: function (request) {
        request.reply.view('home.html', homeConfig);
   }
};

// Define the admin route
var adminConfig = require('../cfg/admin/config.json');
var adminConfigconfig = {
    handler: function (request) {
        request.reply.view('admin/config.html', adminConfig);
   }
};

// Define the server route
var serverconfig = {
    handler: function (request) {
        if (request.payload) {
           console.log(request.payload);
           request.reply.view('server.html', request.payload);
        }
        else {
           var serverConfig = require('../cfg/server.json');
           request.reply.view('server.html', serverConfig);
        }
   }
};

var raweditconfig = {
    handler: function (request) {
        if (request.query.filename == "some.cfg") {
           //request.query.contents = "home contents";
           request.query.contents = fs.readFileSync("/home/lloyd/app/osi-server/node_modules/osi-core/user/"+request.query.filename);
        }
        if (request.save) {
           fs.writeFileSync("/home/lloyd/app/osi-server/node_modules/osi-core/user/"+request.query.contents);
           request.message="Successfully Saved.";
        } else {
           request.message="Not Saved.";
        }
        //console("save value:"+request.query.save);
        request.reply.view('rawedit.html', request.query);
   }
};

exports.register = function (plugin, options, next) {
    plugin.views({
        path: 'templates',
        engines: {
            html: 'handlebars'
        }
    });
    plugin.log(['osi-core', 'info'], 'Plugin registered');
    plugin.select('http').route({ method: '*', path: '/server', config: serverconfig });
    plugin.select('http').route({ method: 'GET', path: '/admin/config', config: adminConfigconfig });
    plugin.select('http').route({ method: '*', path: '/admin/rawedit', config: raweditconfig });
    plugin.select('http').route({ method: 'GET', path: '/', config: homeconfig });
    next();
};
